# Changelog

All notable changes to Kashiwazaki SEO Custom Post Types will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.0.5] - 2025-10-22

### Fixed
- 「スラッグトップページ」で「表示しない」を設定しているのに固定ページが表示される問題を修正
- `archive_display_type !== 'default'` 条件で `'none'` 設定時も固定ページを探していた不具合を解消
- ループで最初にマッチした投稿タイプで処理が終了し、最も長いパスまでチェックされない問題を修正

### Improved
- 階層URL構造で「best match」ロジックを導入し、最も長いパスにマッチする投稿タイプを優先
- `filter_request()`, `handle_request()` のマッチングロジックを改善
- アーカイブ表示制御の条件を `=== 'default'` に統一（「指定なし」の場合のみ固定ページを探す）

## [1.0.4] - 2025-10-21

### Fixed
- 3階層ネストされたカスタム投稿タイプのアーカイブページで404エラーが発生する問題を修正
- `KSTB_Parent_Selector::block_old_urls()`メソッドで直接の親のみを確認していた問題を解決

### Improved
- URL検証ロジックで再帰的なフルパス構築に対応
- `KSTB_Post_Type_Registrar::build_full_path_static()`静的メソッドを追加し、階層構造のパスを正しく構築

## [1.0.3] - 2025-10-11

### Added
- 親ページ選択メタボックスにスラッグ編集フィールドを追加

### Improved
- 階層構造のカスタム投稿タイプで親を選択してもスラッグが編集可能に
- スラッグ入力時にリアルタイムで既存パネルと同期

## [1.0.2] - 2025-10-05

### Changed
- 管理画面UIのシンプル化：不要な設定項目を削除
- リライトスラッグ設定を削除（常に投稿タイプIDを使用）
- RESTベース設定を削除（常に投稿タイプIDを使用）
- REST API設定を削除（常に有効）
- 権限タイプ設定を削除（常に'post'を使用）
- リライト設定を削除（常にきれいなURL、フロントベース無効）

### Improved
- 管理画面の操作性向上
- WordPress現代標準に準拠した設定

## [1.0.1] - 2025-09-24

### Fixed
- カスタム投稿タイプのスラッグ以下に設置された固定ページが404になる問題を修正
- カスタム投稿タイプの個別記事と固定ページの両方が正しく表示されるように改善

### Improved
- アーカイブコントローラーのURL判定ロジックを改善
- スラッグトップページとサブディレクトリページの処理を明確に分離

## [1.0.0] - 2025-09-14

### Added
- カスタム投稿タイプの作成・編集・削除機能
- 管理画面からの直感的な操作インターフェース
- 日本語完全対応
- 階層URL対応（親ディレクトリ/カスタム投稿タイプ/投稿名）
- アーカイブページの表示制御機能
- 固定ページとの自動統合機能
- REST API対応（ブロックエディター対応）
- 豊富なDashiconsアイコン選択
- 詳細なラベルカスタマイズ機能
- サポート機能の選択（タイトル、エディター、アイキャッチ画像など）
- タクソノミー（カテゴリー、タグ）の関連付け
- URLリライト設定
- メニュー位置のカスタマイズ

### Fixed
- アーカイブ非表示時の固定ページ表示問題を解決
- 階層URLでの404エラーを修正
- カスタム投稿タイプメニューの自動表示機能

### Improved
- パフォーマンスの最適化
- コードのリファクタリング
- セキュリティの強化

### Technical
- WordPress 5.0以上対応
- PHP 7.4以上対応
- カスタムデータベーステーブル実装
- Ajax通信による非同期処理
- 自動リライトルールフラッシュ機能