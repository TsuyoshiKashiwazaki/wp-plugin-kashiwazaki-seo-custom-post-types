=== Kashiwazaki SEO Custom Post Types ===
Contributors: tsuyoshikashiwazaki
Tags: custom post type, post type, cpt, custom content, content type
Requires at least: 5.0
Tested up to: 6.6
Stable tag: 1.0.23
License: GPLv2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html
Requires PHP: 7.0

カスタム投稿タイプを簡単に作成・編集・削除できるWordPressプラグイン

== Description ==

Kashiwazaki SEO Custom Post Typesは、WordPressサイトにカスタム投稿タイプを簡単に追加できるプラグインです。
コーディングの知識がなくても、管理画面から直感的な操作でカスタム投稿タイプを作成・管理できます。

= 主な機能 =

* カスタム投稿タイプの作成・編集・削除
* 日本語対応の管理画面
* 詳細なラベル設定
* サポート機能の選択（タイトル、エディター、アイキャッチ画像など）
* タクソノミーの関連付け
* REST API対応（ブロックエディター対応）
* アイコン選択機能
* URLリライト設定
* 階層化対応

= 使い方 =

1. プラグインをインストール・有効化
2. 管理画面の「Kashiwazaki SEO Custom Post Types」メニューをクリック
3. 「新規追加」ボタンをクリック
4. 必要な情報を入力して保存

= 作者について =

柏崎剛 - SEO対策研究室
https://tsuyoshikashiwazaki.jp/

== Installation ==

1. プラグインファイルを `/wp-content/plugins/kashiwazaki-seo-type-builder` ディレクトリにアップロード
2. WordPressの「プラグイン」メニューからプラグインを有効化
3. 管理画面に「Kashiwazaki SEO Custom Post Types」メニューが表示されます

== Frequently Asked Questions ==

= カスタム投稿タイプとは何ですか？ =

カスタム投稿タイプは、WordPressの標準の「投稿」や「固定ページ」以外に、独自のコンテンツタイプを作成できる機能です。
例えば、「商品」「お客様の声」「実績」などのコンテンツを管理するのに便利です。

= 作成したカスタム投稿タイプを削除するとどうなりますか？ =

カスタム投稿タイプの設定は削除されますが、既に投稿されたコンテンツはデータベースに残ります。
同じスラッグで再度カスタム投稿タイプを作成すると、コンテンツが再び表示されます。

= プラグインを無効化するとどうなりますか？ =

プラグインを無効化すると、作成したカスタム投稿タイプは表示されなくなりますが、データは保持されます。
プラグインを再度有効化すると、元通りに使用できます。

== Screenshots ==

1. カスタム投稿タイプ一覧画面
2. 新規作成・編集画面（基本設定タブ）
3. ラベル設定タブ
4. 詳細設定タブ
5. サポート機能選択
6. タクソノミー選択

== Changelog ==

= 1.0.23 =
* Fix: タクソノミーアーカイブのページネーション404問題を修正

= 1.0.22 =
* Fix: 非公開・下書き投稿が未ログインユーザーに表示される脆弱性を修正
* Fix: クエリ文字列URL（?p=ID）による重複コンテンツ問題を修正（正規URLへ301リダイレクト）
* Add: is_post_viewable() メソッド追加（投稿ステータスと権限に基づく表示制御）

= 1.0.21 =
* Add: アーカイブ一覧に子階層の投稿タイプの記事を含める機能を追加
* Add: 管理画面に「子階層の投稿タイプの記事も含める」チェックボックスを追加
* Fix: 子投稿タイプ含有時のページネーション不具合を修正
* Fix: 子投稿タイプ含有時のblock_old_urls()による誤404を修正
* Fix: final_redirect_defense()が子投稿タイプ配列を上書きする問題を修正

= 1.0.20 =
* Add: 階層的カスタム投稿タイプの旧スラッグ保存機能を追加
* Add: スラッグ変更時に旧URLから新URLへの301リダイレクトが機能するよう対応

= 1.0.19 =
* Add: 短縮URL形式（?p=ID）許可機能を追加
* Add: カスタム投稿タイプごとにクエリ文字列URLのリダイレクト動作を制御可能に
* Fix: 短縮URL設定がデータベースに保存されないバグを修正

= 1.0.18 =
* Add: 著者アーカイブページにカスタム投稿タイプの記事を含めるよう対応

= 1.0.17 =
* Add: 親ページセレクターに検索機能を追加（ページ名でフィルタリング）
* Add: 検索時にセレクトボックスを展開表示
* Add: 選択中の親ページを常時表示するUI
* Add: クリアボタンで親ページ解除可能に
* Improve: 標準の親セレクター・スラッグとの双方向連動

= 1.0.16 =
* Fix: 管理バーの「編集」リンクが正しい記事を指すよう修正
* Fix: 下書き・非公開記事のプレビュー対応（編集権限ユーザーのみ）
* Add: get_allowed_post_statuses() ヘルパーメソッド追加
* Add: is_post_accessible() ヘルパーメソッド追加
* Add: fix_admin_bar_edit_link() メソッド追加

= 1.0.15 =
* Fix: WordPress予約語（media, link等）をURLスラッグに使用した際、内部名を自動変換して競合を回避
* Improve: 予約語リストを拡充（media, link, theme, plugin, user, comment, admin, dashboard等30種類以上）

= 1.0.14 =
* Fix: 「指定なし」設定のカスタム投稿タイプスラッグトップページで、同名の投稿が正しく単一投稿として表示されない問題を修正
* Add: body_classフィルターで単一投稿用のクラス追加
* Add: template_includeフィルターで正しいテンプレートを返す処理を追加
* Add: wpアクションでis_singularフラグを確実に設定する処理を追加

= 1.0.13 =
* Add: 階層的カスタム投稿タイプのパーマリンク解決機能（親子関係を持つ投稿のURL解決）
* Fix: 階層的な投稿URL（例: /blog/parent/child/）が404になる問題を修正
* Improve: パーマリンク検証ロジックを改善（query_varsを使用した正確な投稿取得）
* Improve: ドキュメントタイトルの修正機能を追加（階層的投稿で正しいタイトルを表示）

= 1.0.12 =
* Add: 循環参照検出機能（階層構造の無限ループを防止）
* Add: 循環参照自動修正機能（データベースの整合性を自動修復）
* Improve: パフォーマンス向上のためのキャッシュ機能を追加

= 1.0.11 =
* Fix: カテゴリーテーブルが作成されない問題を修正
* Improve: update_database()メソッドにカテゴリーテーブルの存在確認処理を追加
* Improve: create_categories_table()メソッドのエラーハンドリングを強化

= 1.0.10 =
* Add: パーマリンク検証機能（正しいパーマリンク以外でのアクセスを404でブロック）
* Improve: カスタム投稿タイプのCanonical Redirectを無効化

= 1.0.9 =
* Add: メニュー管理タブを追加（カスタム投稿タイプをカテゴリーでフォルダ化）
* Add: カテゴリー機能（複数の投稿タイプをサイドメニューでグループ化）
* Add: カテゴリーアイコン選択機能（21種類のフォルダ系アイコン）
* Add: 親メニューページ（カテゴリークリック時に投稿タイプ一覧を表示）
* Add: 一括保存機能（すべての投稿タイプのメニュー設定を一度に保存）
* Add: 階層構造表示（サブメニューを├と└で視覚化）
* Improve: サブメニューの文字折り返しを防止（white-space: nowrap）
* Improve: アセットファイルのキャッシュクリア機構（ファイルタイムスタンプ使用）
* Fix: メニュー重複表示の問題を修正
* Fix: カテゴリーテーブルの自動作成とマイグレーション処理を改善

= 1.0.8 =
* Fix: url_slugが設定されている投稿タイプでURLマッチングが正しく動作しない問題を修正
* Improve: build_full_path関数でurl_slugを優先的に使用するように改善

= 1.0.7 =
* Add: 64文字までの長いスラッグに対応（URLスラッグと内部スラッグを分離）
* Add: カスタムリライトルールによる長いURL→短い内部名のマッピング機能
* Add: スラッグ入力時の20文字超過警告表示機能（フォーム内警告ボックス）
* Add: 記事移動機能にカテゴリー/タクソノミーフィルタリング機能を追加
* Add: 管理画面一覧に投稿数列を追加（クリックで投稿一覧へ遷移）
* Add: テーブルソート機能を追加（ラベル、投稿数、パス、スラッグの各列でソート可能）
* Improve: 短いURLへのアクセスをブロック（長いURLのみ許可）
* Improve: WordPress内部は20文字制限を維持しつつ、URLは64文字まで使用可能に
* Improve: 他のプラグインやテーマとの互換性を向上
* Improve: スラッグ入力フィールドを単一化（内部スラッグは自動生成）
* Improve: 管理画面一覧のデフォルトソートをパス順に変更
* Improve: スラッグ列でアーカイブURLを表示
* Fix: データベースマイグレーション機能追加（既存環境でも自動対応）
* Fix: メニュー位置が正しく機能するように修正

= 1.0.6 =
* Fixed: カスタム投稿タイプの階層URLで投稿が表示されない問題を修正
* Fixed: カスタム投稿タイプの投稿本文が表示されない問題を修正
* Added: 管理画面にタブ切り替え機能を実装（一覧/説明書）
* Added: パス列を追加し、階層構造を完全パス表示
* Added: 編集フォームに閉じるボタンを追加
* Improved: リライトルールのソート処理を改善し、より具体的なルールを優先
* Improved: 管理画面の横幅を100%に変更、表示領域を拡大
* Improved: ラベルクリックで投稿管理画面へ遷移可能に

= 1.0.5 =
* Added: 記事移動機能の実装（カスタム投稿タイプ間で記事を移動）
* Added: 管理画面に記事移動タブを追加
* Fixed: 「スラッグトップページ」で「表示しない」設定時に固定ページが表示される問題を修正
* Improved: 階層URLマッチングで最長パス優先ロジックを実装

= 1.0.4 =
* Fixed: 3階層ネストされたカスタム投稿タイプのアーカイブページで404エラーが発生する問題を修正
* Improved: URL検証ロジックで再帰的なフルパス構築に対応

= 1.0.3 =
* Added: 親ページ選択メタボックスにスラッグ編集フィールドを追加
* Improved: 階層構造のカスタム投稿タイプで親を選択してもスラッグが編集可能に
* Improved: スラッグ入力時にリアルタイムで既存パネルと同期

= 1.0.2 =
* Changed: 管理画面UIのシンプル化（不要な設定項目を削除）
* Improved: 操作性向上とWordPress現代標準への準拠

= 1.0.1 =
* Fixed: カスタム投稿タイプのスラッグ以下に設置された固定ページが404になる問題を修正
* Improved: アーカイブコントローラーのURL判定ロジックを改善

= 1.0.0 =
* 初回リリース

== Upgrade Notice ==

= 1.0.22 =
非公開投稿の表示制御とクエリ文字列URLの重複コンテンツ問題を修正しました。セキュリティ上、アップデートを推奨します。

= 1.0.21 =
アーカイブ一覧に子階層の投稿タイプの記事を含める機能を追加しました。

= 1.0.20 =
階層的カスタム投稿タイプでスラッグ変更時に旧URLから自動で301リダイレクトされるようになりました。

= 1.0.16 =
管理バーの「編集」リンクが正しい記事を指すようになりました。下書き・非公開記事のプレビューにも対応。

= 1.0.15 =
WordPress予約語（media, link等）をURLスラッグに使用できるようになりました。内部名は自動変換されます。

= 1.0.14 =
「指定なし」設定のカスタム投稿タイプで、同名の投稿が正しく単一投稿として表示されるようになりました。

= 1.0.13 =
階層的カスタム投稿タイプ（hierarchical）で親子関係を持つ投稿のURLが正しく解決されるようになりました。

= 1.0.12 =
循環参照検出・自動修正機能とキャッシュ機能を追加。階層構造の安定性とパフォーマンスが向上しました。

= 1.0.10 =
パーマリンク検証機能を追加。正しくないパーマリンクでのアクセスを404でブロックし、SEOを改善します。

= 1.0.9 =
メニュー管理機能を追加。カスタム投稿タイプをカテゴリーでフォルダ化し、管理画面を整理できます。データベーステーブルが自動作成されます。

= 1.0.8 =
長いURLスラッグ（url_slug）が設定されている投稿タイプでURLマッチングが正しく動作するように修正されました。

= 1.0.7 =
64文字スラッグ対応の大規模アップデート。記事移動機能にカテゴリーフィルタリングを追加。データベースは自動マイグレーションされます。

= 1.0.6 =
カスタム投稿タイプの階層URLで投稿が正しく表示され、管理画面UIが大幅に改善されました。アップデートを推奨します。

= 1.0.5 =
アーカイブ表示制御の不具合を修正しました。アップデートを推奨します。

= 1.0.4 =
3階層以上のネストされたカスタム投稿タイプのアーカイブページが正しく表示されるようになりました

= 1.0.3 =
親ページを選択した状態でもスラッグを自由に編集できるようになりました

= 1.0.2 =
管理画面がよりシンプルで使いやすくなりました

= 1.0.1 =
カスタム投稿タイプのスラッグ以下の固定ページが正しく表示されるようになりました

= 1.0.0 =
初回リリース

